-- Player ESP Highlighter
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer

-- GUI Setup
local gui = Instance.new("ScreenGui")
gui.Name = "ESP_GUI"
gui.Parent = player:WaitForChild("PlayerGui")

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 240, 0, 120)
frame.Position = UDim2.new(0, 20, 0, 20)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.Active = true
frame.Draggable = true

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1, -20, 0, 30)
title.Position = UDim2.new(0, 10, 0, 10)
title.Text = "Player ESP"
title.TextColor3 = Color3.fromRGB(255,255,255)
title.BackgroundTransparency = 1
title.Font = Enum.Font.GothamBold
title.TextSize = 16

local toggle = Instance.new("TextButton", frame)
toggle.Size = UDim2.new(1, -20, 0, 40)
toggle.Position = UDim2.new(0, 10, 0, 50)
toggle.Text = "Activate"
toggle.Font = Enum.Font.GothamBold
toggle.TextSize = 14
toggle.TextColor3 = Color3.fromRGB(255,255,255)
toggle.BackgroundColor3 = Color3.fromRGB(70,70,70)
toggle.AutoButtonColor = true

local status = Instance.new("TextLabel", frame)
status.Size = UDim2.new(1, -20, 0, 20)
status.Position = UDim2.new(0, 10, 0, 100)
status.Text = "Status: Inactive"
status.TextColor3 = Color3.fromRGB(200,200,200)
status.BackgroundTransparency = 1
status.Font = Enum.Font.Gotham
status.TextSize = 12

-- State
local ACTIVE = false
toggle.MouseButton1Click:Connect(function()
    ACTIVE = not ACTIVE
    toggle.Text = ACTIVE and "Deactivate" or "Activate"
    status.Text = ACTIVE and "Status: Active" or "Status: Inactive"
end)

-- Table to store highlights
local highlights = {}

-- Function to create highlight
local function createHighlight(character)
    if not character then return end
    if highlights[character] then return end

    local h = Instance.new("BoxHandleAdornment")
    h.Adornee = character:FindFirstChild("HumanoidRootPart") or character:FindFirstChildWhichIsA("BasePart")
    if not h.Adornee then return end
    h.AlwaysOnTop = true
    h.ZIndex = 10
    h.Size = Vector3.new(4,6,2)
    h.Color = Color3.fromRGB(255,0,0)
    h.Transparency = 0.5
    h.Parent = workspace

    highlights[character] = h
end

-- Function to remove highlight
local function removeHighlight(character)
    if highlights[character] then
        highlights[character]:Destroy()
        highlights[character] = nil
    end
end

-- Update highlights every second
while true do
    if ACTIVE then
        -- Remove highlights for players who left
        for char, h in pairs(highlights) do
            if not char.Parent then
                removeHighlight(char)
            end
        end

        -- Add highlights for current players
        for _, plr in pairs(Players:GetPlayers()) do
            if plr ~= player and plr.Character then
                createHighlight(plr.Character)
            end
        end
    else
        -- Remove all highlights if not active
        for char, h in pairs(highlights) do
            removeHighlight(char)
        end
    end
    wait(1)
end
